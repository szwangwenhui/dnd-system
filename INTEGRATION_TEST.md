# DND2 系统重构 - 集成测试清单

## 测试环境准备

1. 解压 `DND2-Final.zip` 到 D盘根目录
2. 打开命令行，进入 `D:\DND2` 目录
3. 运行 `python -m http.server 8273`
4. 浏览器打开 `http://localhost:8273`

---

## 一、核心功能测试

### 1.1 项目管理
- [ ] 新建项目
- [ ] 编辑项目名称
- [ ] 删除项目
- [ ] 进入项目

### 1.2 字段定义
- [ ] 新建字段（各种类型）
- [ ] 编辑字段
- [ ] 删除字段

### 1.3 表单定义
- [ ] 新建基础表（独立/关联）
- [ ] 新建派生表
- [ ] 新建属性表
- [ ] 新建合并表
- [ ] 编辑表单结构
- [ ] 删除表单

### 1.4 角色管理
- [ ] 新建角色
- [ ] 编辑角色权限
- [ ] 删除角色

### 1.5 页面定义
- [ ] 新建页面
- [ ] 编辑页面属性
- [ ] 删除页面

---

## 二、拆分模块测试

### 2.1 数据库模块 (Phase 1)
- [ ] 数据保存到IndexedDB
- [ ] 数据读取正常
- [ ] 跨页面数据持久化

### 2.2 预览模块 (Phase 3)
- [ ] 打开预览页面 (`preview.html`)
- [ ] 页面渲染正常
- [ ] 区块显示正确
- [ ] 交互功能正常

### 2.3 流程引擎模块 (Phase 4)
- [ ] 创建数据流程
- [ ] 添加各类节点（读取/写入/分支/循环等）
- [ ] 绑定流程到按钮
- [ ] 预览页面执行流程
- [ ] 流程变量正确传递

### 2.4 页面设计器模块 (Phase 5)
- [ ] 打开设计器
- [ ] 添加区块
- [ ] 拖拽区块
- [ ] 缩放区块
- [ ] 样式配置
- [ ] 保存设计
- [ ] 关闭设计器（确认弹窗）

### 2.5 统计模块 (Phase 6)
- [ ] 新建统计表
- [ ] 配置统计维度
- [ ] 预览统计结果
- [ ] 图表显示
- [ ] 导出功能

### 2.6 表达式构建器 (Phase 8)
- [ ] 加法/减法/乘法/除法
- [ ] 分段函数（连续/离散）
- [ ] 锚点构建
- [ ] 表达式保存

---

## 三、集成测试场景

### 场景1: 完整业务流程
1. 新建项目
2. 定义字段（姓名、年龄、金额）
3. 创建基础表
4. 创建页面
5. 设计页面（添加表单区块）
6. 预览页面
7. 录入数据
8. 验证数据保存

### 场景2: 数据流程执行
1. 创建数据流程
2. 添加读取节点
3. 添加计算节点
4. 添加写入节点
5. 绑定到按钮
6. 预览执行
7. 验证结果

### 场景3: 统计分析
1. 准备测试数据
2. 创建统计表
3. 配置分组和汇总
4. 查看统计结果
5. 导出数据

---

## 四、已知问题

### 4.1 按钮样式问题
- **现象**: 按钮区块的样式在预览页面丢失
- **原因**: 设计页面和预览页面使用两套样式系统
- **状态**: 待后续优化

---

## 五、重构成果统计

| Phase | 内容 | 原行数 | 拆分后文件数 |
|-------|------|--------|--------------|
| 1 | db.js | 1,868 | 8 |
| 2 | 小文件复制 | - | 132 |
| 3 | Preview.jsx | 2,389 | 5 |
| 4 | FlowEngine.js | 2,233 | 4 |
| 5 | PageDesigner.jsx | 1,739 | 5 |
| 6 | StatisticsModule | 1,799 | 8 |
| 7 | FormDefinition | 496 | (已合理) |
| 8 | ExpressionBuilder | 1,669 | 3 |

**最终源文件数**: 144个

---

## 六、验收标准

- [ ] 所有核心功能正常
- [ ] 控制台无报错
- [ ] 数据持久化正常
- [ ] 各拆分模块加载正常
- [ ] 页面设计器可用
- [ ] 预览功能可用
- [ ] 流程引擎可执行
